---
title: "Visualizations FINAL"
author: "Mark Hertzfeld"
format: html
editor: visual
---

Sources used :

Inspiration: https://www.cbo.gov/publication/58532

Data source: CDC WONDER database, Centers for Disease Control and Prevention, National Center for Health Statistics, “About Multiple Cause of Death 1999–2020” https://wonder.cdc.gov/mcd-icd10.html.

The only correction I made for usability to the .csv file generated was to Change one column name to Drug Type instead of what was originally generated.

The data source required me to specify my criteria, which I did which resulted in a more polished data source.

```{r}
library(tidyverse)
library(highcharter)
library(dplyr)

                       
CDC_Drug_Type_Overdose_Overtime <- read_csv(file.path
                            ("CDC, Multiple Cause of Death by Drug Type 1999-2020.csv"))
                       
```

```{r}
CDC_TDD <- CDC_Drug_Type_Overdose_Overtime |>
  group_by(Year) |>
  mutate(across(where(is.character), as.factor)) |>
  mutate(`Drug Type` = recode(`Drug Type`,
    "Other opioids" = "Prescription Opioids",
    "Other synthetic narcotics" = "Synthetic Opioids",
    "Other and unspecified narcotics" = "Multi-mixed opioids",
    "Psychostimulants with abuse potential" = "Psychostimulants")) |>
  filter(`Drug Type` != "Psychostimulants")
```

```{R}
CDC_TDD_TLLL <- CDC_TDD |>
  group_by(Year) |>
  mutate(Total_Deaths = sum(Deaths, na.rm = TRUE))
```

```{r}
CDC_TDD_TLLL |>
  hchart(type = "column", hcaes(x = Year, y = Total_Deaths))|>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Overdose Daeths"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             plotLines = list(
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 1999, zIndex = 5,
        label = list(text = "Wave 1", align = "center", 
                     rotation = 0, verticalAlign = "above", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2010, zIndex = 5,
        label = list(text = "Wave 2", align = "center", 
                     rotation = 0, verticalAlign = "top", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2013, zIndex = 5,
        label = list(text = "Wave 3", align = "center",
                     rotation = 0, verticalAlign = "top", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2019, zIndex = 5,
        label = list(text = "Wave 4", align = "center", 
                     rotation = 0, verticalAlign = "top", y = -5)
      ))) |>
    hc_title(text = "Opiod Overdose Deaths Across US 1999-2023") |>
    hc_subtitle(text = "Sourced from https://wonder.cdc.gov/mcd-icd10.html") |>
    hc_colors(c("#FFB300")) |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Deaths: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  )
)
```

```{r}
CDC_TDD |>
  hchart(type = "line", hcaes(x = Year, y = Deaths, group = `Drug Type`)) |>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Overdose Daeths"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash") |>
    hc_title(text = "<b>Drug Overdoses in US between 2000 and 2020 by Drug Type<b>") |>
    hc_colors(c("#F8766D", "#7CAE00", "#00BFC4", "#C77CFF", "#FFB300")) |>
    hc_legend(enabled = TRUE, layout = "horizontal", align = "center", verticalAlign = "bottom") |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Deaths: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  ))
```

```{r}
CDC_TDD_2 <- CDC_TDD |>
  filter(`Drug Type` == "Prescription Opioids")
```

```{r}
CDC_TDD_2 |>
  hchart(type = "column", hcaes(x = Year, y = Deaths)) |>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Deaths"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             plotLines = list(
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2016, zIndex = 5,
        label = list(text = "CARA & 21st Century Cures Act", align = "center", 
                     rotation = 0, verticalAlign = "above", y = -5)),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2018, zIndex = 5,
        label = list(text = "SUPPORT Act", align = "center", 
                     rotation = 0, verticalAlign = "above", y = 10)),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2011, zIndex = 5,
        label = list(text = "FDA Opioid REMS (Risk Evaluation and Mitigation Strategy)                                  Requirements", align = "center",rotation = 0,
                     verticalAlign = "above", y = 25)))
        ) |>
    hc_title(text = "<b>Amount of Prescription Opioid Deaths in US across 1992 to 2020 impacted by policies<b>") |>
    hc_colors(c("#F8766D")) |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Deaths: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  ))
```
