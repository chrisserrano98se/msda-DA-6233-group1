---
title: "Visualizations FINAL"
author: "Mark Hertzfeld"
format: html
editor: visual
---

Sources used: https://www.cbo.gov/publication/58532

I used a report I found from the Congressional Budget Office which used the following sources: - Data source: Congressional Budget Office, using information from the CDC WONDER database, Centers for Disease Control and Prevention, National Center for Health Statistics, “About Multiple Cause of Death 1999–2020” (accessed January 5, 2022), https://wonder.cdc.gov/mcd-icd10.html. See www.cbo.gov/publication/58221#data.

-   Data source: IQVIA Institute for Human Data Science, Prescription Opioid Trends in the United States: Measuring and Understanding Progress in the Opioid Crisis (December 2020), https://tinyurl.com/5a9dk8en. See www.cbo.gov/publication/58221#data.

```{r}
library(tidyverse)
library(highcharter)
library(dplyr)
                       
Drug_Type_Overdose_Overtime <- read_csv(file.path
                            ("CBO_Drug_Overdose_Deaths_by_Drug_Type.csv"))

Opioids_Prescribed_Overtime <- read_csv(file.path
                            ("CBO_Opioids_Prescribed_Over_Time.csv"))

opioid_deaths_total <- read_csv(file.path
                            ("Opiod_Data_Combined.csv"))
                       
```

```{r}
Opioid_Total_deaths <- opioid_deaths_total |>
  filter(`Drug Type` == "All opioids") |>
  filter(`Location` == "United States") |>
  mutate(Data = as.numeric(Data)) |>
  mutate(across(where(is.character), as.factor)) |>
  mutate(Data = round(Data * 100000),0)
```

```{r}
Opioid_Total_deaths |>
  hchart(type = "column", hcaes(x = TimeFrame, y = Data))|>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Overdose Daeths"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             plotLines = list(
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 1999, zIndex = 5,
        label = list(text = "Wave 1", align = "center", 
                     rotation = 0, verticalAlign = "above", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2010, zIndex = 5,
        label = list(text = "Wave 2", align = "center", 
                     rotation = 0, verticalAlign = "top", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2013, zIndex = 5,
        label = list(text = "Wave 3", align = "center",
                     rotation = 0, verticalAlign = "top", y = -5)
            ),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2019, zIndex = 5,
        label = list(text = "Wave 4", align = "center", 
                     rotation = 0, verticalAlign = "top", y = -5)
      ))) |>
    hc_title(text = "Opiod Overdose Deaths Across US 1999-2023") |>
    hc_colors(c("#FFB300")) |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Deaths: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  )
)
```

```{r}
DTOO <- Drug_Type_Overdose_Overtime |>
  mutate(`Drug Type` = as.factor(`Drug Type`)) |>
  mutate(`Overdose Deaths` = `Overdose Deaths` * 1000) |>
  filter(`Drug Type` != "Any Opioid")
```

```{r}
DTOO |>
  hchart(type = "line", hcaes(x = Year, y = `Overdose Deaths`, group = `Drug Type`)) |>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Overdose Daeths"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash") |>
    hc_title(text = "<b>Drug Overdoses in US between 2000 and 2020 by Drug Type<b>") |>
    hc_subtitle(text = "This data is sourced from https://www.cbo.gov/publication/58532") |>
    hc_colors(c("#7CAE00", "#00BFC4", "#C77CFF", "#FFB300")) |>
    hc_legend(enabled = TRUE, layout = "horizontal", align = "center", verticalAlign = "bottom") |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Deaths: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  ))
```

```{r}
OPO <- Opioids_Prescribed_Overtime |>
  filter(Year >= 2000)
```

```{r}
OPO |>
  hchart(type = "line", hcaes(x = Year, y = `Opioids Dispensed in Billions`)) |>
    hc_chart(backgroundColor = "#e8f4f8") |>
    hc_yAxis(title = list(text = "Prescription Opiods Prescribed (Billions)"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             labels = list(
               formatter = JS("function () { return Highcharts.numberFormat",
                              "(this.value, 0, '.', ','); }")))|>
    hc_xAxis(title = list(text = "Year"),
             gridLineWidth = 1,
             gridLineDashStyle = "Dash",
             plotLines = list(
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2016, zIndex = 5,
        label = list(text = "CARA & 21st Century Cures Act", align = "center", 
                     rotation = 0, verticalAlign = "above", y = -5)),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2018, zIndex = 5,
        label = list(text = "SUPPORT Act", align = "center", 
                     rotation = 0, verticalAlign = "above", y = 10)),
        list(
        color = "red", dashStyle = "Dash", width = 2, value = 2011, zIndex = 5,
        label = list(text = "FDA Opioid REMS (Risk Evaluation and Mitigation Strategy)                                  Requirements", align = "center",rotation = 0,
                     verticalAlign = "above", y = 25)))
        ) |>
    hc_title(text = "<b>Total Amount of opioids prescribed in US across 1992 to 2020<b>") |>
    hc_subtitle(text = "This data is sourced from https://www.cbo.gov/publication/58532") |>
    hc_colors(c("#F8766D")) |>
    hc_tooltip(
      pointFormatter = JS(
    "function() { 
       return 'Opiods Prescribed: <b>' + Highcharts.numberFormat(this.y, 0, '.', ',') + '</b>'; 
     }"
  ))
```
